var timeout_geo=null;
function photo_geo_edit_meta(h){timeout_geo&&clearTimeout(timeout_geocontext);var f=$("#edit_geo").attr("geo:context"),e={0:"in a place that doesn't matter (not defined)",1:"indoors",2:"outdoors"},a='<div id="modal_geo">';a='<form id="photo_geo_update_context">';a+="<h3>Edit theo geo context for this photo</h3>";a+="This photo was taken ";a+='<select id="new_geocontext">';for(i in e){a+='<option value="'+i+'"';if(i==f)a+=' selected="true" disabled="true"';a+=">"+e[i]+"</option>"}a+="</select>";a+=
"&#160;";a+='<input type="submit" value="UPDATE" />';a+="</form>";a+="</div>";a+='<div id="photo_geo_status"></div>';a+='<div id="photo_geo_close"><a href="#" onclick="$.modal.close(); return false;">close</a></div>';$.modal(a);$("#photo_geo_update_context").submit(function(){var d=$("#new_geocontext");d=d.val();if(d==f)alert("Hey! There's nothing to update!");else{$.ajax({url:"/api/",type:"POST",data:{method:"flickr.photos.geo.setContext",photo_id:h,context:d},success:function(b){if(b.stat!="ok")$("#photo_geo_status").html("Ack! There was a problem calling the Flickr API.");
else{$("#edit_geo").attr("geo:context",b.context);var c=e[b.context],g="";if(b.context!=0){b=$("#edit_geo").attr("geo:woeid");g='It was taken <a href="'+(places_url+b+"/"+c+"/")+'">'+c+"</a>"}$("#geo_context").html(g);c="<p>Success! The geo context for this photo has been updated and is now <strong>"+c+"</strong>.</p>";c+='<p style="font-style:italic;font-size:small;">This dialog will close itself automagically in a moment...</p>';$("#photo_geo_status").html(c);timeout_geocontext=setTimeout(function(){$.modal.close()},
2E3)}}});$("#photo_geo_update_context").hide();$("#photo_geo_status").html("Poking the Flickr API...");return false}})};
