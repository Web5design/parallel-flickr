var photo_geo_ctx_map={0:"in a place that doesn't matter (not defined)",1:"indoors",2:"outdoors"};
function photo_geo_edit_meta(){var a='<div id="modal_geo">';a+='<div id="photo_geo_status"></div>';a+=_photo_geo_context_generate_html();a+=_photo_geo_corrections_generate_html();a+='<div id="photo_geo_close"><a href="#" onclick="$.modal.close(); return false;">close</a></div>';a+="</div>";$.modal(a);$("#photo_geo_corrections_fetch").click(_photo_geo_corrections_fetch_onclick);$("#photo_geo_update_context").submit(_photo_geo_context_update_onsubmit)}
function _photo_geo_context_generate_html(){var a=$("#edit_geo").attr("geo:context"),b='<div id="photo_geo_context">';b+="<h3>Edit the geo context for this photo</h3>";b+='<form id="photo_geo_update_context">';b+="This photo was taken ";b+='<select id="new_geocontext">';for(i in photo_geo_ctx_map){b+='<option value="'+i+'"';if(i==a)b+=' selected="true" disabled="true"';b+=">"+photo_geo_ctx_map[i]+"</option>"}b+="</select>";b+="&#160;";b+='<input type="submit" value="UPDATE" />';b+="</form>";b+="</div>";
return b}function _photo_geo_corrections_generate_html(){var a="",b=$("#geo_placename a").html();a+='<div id="photo_geo_corrections">';a+="<h3>Edit the place name for this photo</h3>";a+="<p>Flickr thinks this photo was taken in <q>";a+=b;a+='</q>. <a href="#" id="photo_geo_corrections_fetch">Fetch the list of alternate place names.</a>';a+="</p>";a+="</div>";return a}
function _photo_geo_context_update_onsubmit(){var a=$("#edit_geo").attr("geo:context"),b=$("#new_geocontext");b=b.val();if(b==a)alert("Hey! There's nothing to update!");else{$.ajax({url:"/api/",type:"POST",data:{method:"flickr.photos.geo.setContext",photo_id:photo_id,context:b},success:_photo_geo_set_context_onsuccess});$("#photo_geo_update_context").hide();$("#photo_geo_status").html("Poking the Flickr API...");return false}}
function _photo_geo_set_context_onsuccess(a){if(a.stat!="ok")$("#photo_geo_status").html("Ack! There was a problem calling the Flickr API.");else{$("#edit_geo").attr("geo:context",a.context);var b=photo_geo_ctx_map[a.context],c="";if(a.context!=0){a=$("#edit_geo").attr("geo:woeid");c='It was taken <a href="'+(places_url+a+"/"+b+"/")+'">'+b+"</a>"}$("#geo_context").html(c);b="<p>Success! The geo context for this photo has been updated and is now <strong>"+b+"</strong>.</p>";$("#photo_geo_status").html(b)}}
function _photo_geo_corrections_fetch_onclick(){$.ajax({url:"/api/",type:"GET",data:{method:"flickr.photos.geo.possibleCorrections",photo_id:photo_id,place_type:"neighbourhood"},success:_photo_geo_possible_corrections_onsuccess});$("#photo_geo_corrections_fetch").hide();$("#photo_geo_status").html("Fetching alternate place names...")}
function _photo_geo_possible_corrections_onsuccess(a){$("#photo_geo_status").html("");if(a.stat!="ok")$("#photo_geo_status").html("Ack!");else{var b=$("#edit_geo").attr("geo:woeid"),c='<form id="photo_geo_corrections_update">';c+="It was really taken in ";c+='<select id="new_woeid">';c+="<option />";for(var f=a.places.length,d=0;d<f;d++){var e=a.places[d];c+='<option value="'+e.woeid+'"';if(e.woeid==b)c+=' disabled="true"';c+=">"+e.name+"</option>"}c+="</select>";c+="&#160;&#160;";c+='<input type="submit" value="UPDATE" />';
c+="</form>";$("#photo_geo_corrections").append(c);$("#photo_geo_corrections_update").submit(_photo_geo_corrections_update_onsubmit)}}function _photo_geo_corrections_update_onsubmit(){var a=$("#new_woeid");a=a.val();$.ajax({url:"/api/",type:"POST",data:{method:"flickr.photos.geo.correctLocation",photo_id:photo_id,woeid:a},success:_photo_geo_correct_location_onsuccess});$("#photo_geo_corrections_update").hide();$("#photo_geo_status").html("Poking the Flickr API...");return false}
function _photo_geo_correct_location_onsuccess(a){$("#photo_geo_status").html(a.stat);console.log(a)};
