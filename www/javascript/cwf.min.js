var photos=[],thumbs=[],images=[],count_photos=0,count_updates=0,idx=0;function cwf_init(a){photos=a;count_photos=photos.length;cwf_init_layout();cwf_init_shortcuts();for(a=0;a<count_photos;a++){thumbs.push(photos[a][6]);images.push(photos[a][7])}$.backstretch(thumbs[0]);$({}).imageLoader({images:thumbs,async:true});$({}).imageLoader({images:[images.shift()],async:false,complete:function(){cwf_show_photo(idx)}});a=parseInt(new Date/1E3);cwf_schedule_check_photos(a)}
function cwf_init_subscription(){var a=function(b){b=JSON.parse(b);b=b.photos;var e=b.length;if(e){for(var c=[],d=0;d<e;d++){var f=b[d];c.push([f.photo_id,f.title,f.owner,f.ownername,f.faved_by_nsid,f.faved_by,f.thumb_url,f.display_url])}cwf_init(c)}else{b=new Date;b=String(b);b="Last checked at "+b+", still nothing yet.";$("#last_check").html(b);cwf_init_subscription(6E4)}};setTimeout(function(){$.ajax({url:"/api",data:{method:"flickr.photos.friends.faves"},success:a})},6E4)}
function cwf_init_layout(){$("#content").hide();$("#main").css("background-color","transparent");$("#footer").css("opacity",".75");$("#main").append('<div id="cwf_about"></div>')}function cwf_init_shortcuts(){$(document).keypress(function(a){if(a.keyCode==37)cwf_show_previous_photo("overflow");else if(a.keyCode==38)cwf_show_photo(0);else if(a.keyCode==39)cwf_show_next_photo("overflow");else a.keyCode==40&&cwf_show_photo(count_photos-1)})}
function cwf_schedule_check_photos(a){setTimeout(function(){$.ajax({url:"/api",data:{method:"flickr.photos.friends.faves",older_than:a},success:cwf_check_photos_callback,error:function(b){console.log(b);cwf_schedule_check_photos(a)}})},6E4)}function cwf_check_photos_callback(a){try{_cwf_check_photos_callback(a)}catch(b){console.log(b);console.log(a)}last_check=parseInt(new Date/1E3);cwf_schedule_check_photos(last_check)}
function _cwf_check_photos_callback(a){a=JSON.parse(a);a=a.photos;var b=a.length;if(b){a.reverse();for(var e=[],c=0;c<b;c++){var d=a[c];e.push(d.display_url);e.push(d.thumb_url);photos.unshift([d.photo_id,d.title,d.owner,d.ownername,d.faved_by_nsid,d.faved_by,d.thumb_url,d.display_url])}$({}).imageLoader({images:e,async:true});idx+=b;count_updates+=b;a='<a href="#" onclick="cwf_show_photo(0);return false;">';a+=count_updates>1?"there are "+count_updates+" new faves":"there are new faves";a+="</a>";
$("#cwf_updates").html(a);$("#cwf_count_photos").html(photos.length)}}function cwf_next_photo(a){if(a)return idx<photos.length-1?idx+1:0;return idx<photos.length-1?idx+1:-1}function cwf_previous_photo(a){if(a)return idx>0?idx-1:count_photos-1;return idx>0?idx-1:-1}function cwf_show_previous_photo(a){a=cwf_previous_photo(a);cwf_show_photo(a)}function cwf_show_next_photo(a){a=cwf_next_photo(a);cwf_show_photo(a)}
function cwf_show_photo(a){count_updates=0;idx=a;for(var b=[],e=0;e<2;e++){if(!images.length)break;b.push(images.shift());b.push(images.unshift())}b.length&&$({}).imageLoader({images:b,async:true});var c=photos[a];b=c[0];e=c[1];var d=c[2],f=c[3],g=c[4],h=c[5],i=c[6];c=c[7];a=a+1;e=e+", by "+f;msg='<a href="http://www.flickr.com/photos/'+d+"/"+b+'/" target="_flickr" title="'+e+'">';msg+='<img src="'+c+'" /></a><br >';msg+='<div id="cwf_about_text">';msg+='<a href="http://www.flickr.com/photos/'+g+
'/faves/" target="_flickr">'+h+"</a>";msg+=' <span style="font-size:1.2em;font-weight:700;">\u2606</span>  ';msg+='<a href="http://www.flickr.com/photos/'+d+'/" target="_flickr">'+f+"</a><br />";msg+="no. "+a+' of <span id="cwf_count_photos">'+count_photos+"</span> faves";if(a>1)msg+=' / <a href="#" onclick="cwf_show_next_photo();return false;">before</a>';if(a<count_photos)msg+=' / <a href="#" onclick="cwf_show_previous_photo();return false;">after</a>';msg+='<div id="cwf_updates"></div>';msg+="</div>";
$("#cwf_about").html("");$.backstretch(i);$("#cwf_about").html(msg)};
